<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Bienvenido</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="css/normalize.css">
  <link rel="stylesheet" type="text/css" href="css/framework.css">
  <link rel="stylesheet" type="text/css" href="css/styles.css">
  <link rel="shortcut icon" type="image/x-icon" href="images/logo.ico">
  <link rel="apple-touch-icon" href="images/logo.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link href="css/ionicons.min.css" rel="stylesheet" type="text/css" />
</head>
<body style="background: #E3E3E3;">
  <section class="w-section mobile-wrapper" style="background: #E3E3E3;">
    <div class="page-content" id="main-stack">
      <div class="w-nav navbar" data-collapse="all" data-animation="over-left" data-duration="400" data-contain="1" data-easing="ease-out-quint" data-no-scroll="1">
        <div class="w-container">
          <nav class="w-nav-menu nav-menu bg-gradient-alt" role="navigation">
            <div class="nav-menu-header">
              <div class="logo">Menú</div>
            </div>
            <a class="w-clearfix w-inline-block nav-menu-link" href="home.html" data-load="1">
              <div class="icon-list-menu">
                <div class="icon ion-ios-home-outline"></div>
              </div>
              <div class="nav-menu-titles">Inicio</div>
            </a>
            <!--a class="w-clearfix w-inline-block nav-menu-link" href="itinerario.html" data-load="1">
              <div class="icon-list-menu">
                <div class="icon ion-ios-clock-outline"></div>
              </div>
              <div class="nav-menu-titles">Itinerario</div>
            </a>
            <a class="w-clearfix w-inline-block nav-menu-link" href="programa.html" data-load="1">
              <div class="icon-list-menu">
                <div class="icon ion-ios-calendar-outline"></div>
              </div>
              <div class="nav-menu-titles">Programa</div>
            </a>
            <a class="w-clearfix w-inline-block nav-menu-link" href="conferencistas.html" data-load="1">
              <div class="icon-list-menu">
                <div class="icon ion-ios-people"></div>
              </div>
              <div class="nav-menu-titles">Conferencistas</div>
            </a>
            <a class="w-clearfix w-inline-block nav-menu-link" href="auditorio.html" data-load="1">
              <div class="icon-list-menu">
                <div class="icon ion-location"></div>
              </div>
              <div class="nav-menu-titles">Auditorio</div>
            </a-->
            <a class="w-clearfix w-inline-block nav-menu-link" href="transportacion.html" data-load="1">
                <div class="icon-list-menu">
                  <div class="icon ion-grid"></div>
                </div>
                <div class="nav-menu-titles">Inmuebles</div>
              </a>
              <a class="w-clearfix w-inline-block nav-menu-link" href="incidencias.html" data-load="1">
                <div class="icon-list-menu">
                  <div class="icon ion-grid"></div>
                </div>
                <div class="nav-menu-titles">Incidencias</div>
              </a>
              <a class="w-clearfix w-inline-block nav-menu-link" href="transportacion.html" data-load="1">
                <div class="icon-list-menu">
                  <div class="icon ion-grid"></div>
                </div>
                <div class="nav-menu-titles">Almacen</div>
              </a>
              <a class="w-clearfix w-inline-block nav-menu-link" href="novedades.html" data-load="1">
                <div class="icon-list-menu">
                  <div class="icon ion-grid"></div>
                </div>
                <div class="nav-menu-titles">Novedades</div>
              </a>
            <a class="w-clearfix w-inline-block nav-menu-link" id="logout" href="#" data-load="1">
              <div class="icon-list-menu">
                <div class="icon ion-log-out"></div>
              </div>
              <div class="nav-menu-titles">Salir</div>
            </a>
            <div class="separator-bottom"></div>
            <div class="separator-bottom"></div>
            <div class="separator-bottom"></div>
          </nav>
          <div class="wrapper-mask" data-ix="menu-mask"></div>
          <div class="navbar-title">Nueva Incidencia</div>
          <div class="w-nav-button navbar-button left" id="menu-button" data-ix="hide-navbar-icons">
            <div class="navbar-button-icon home-icon">
              <div class="bar-home-icon top"></div>
              <div class="bar-home-icon middle"></div>
              <div class="bar-home-icon bottom"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="body">
        <div class="home-content">

          <div style="padding-top: 20px; text-align: center;">
            <form id="form-insidencia" style="padding: 20px;">
                <label for="select_inmueble" style="text-align: left;">Inmueble</label>
                <select name="select_inmueble" class="w-input" id="select_inmueble" required></select>
                <label for="fecha" style="text-align: left;">Fecha</label>
                <input type="date" class="w-input" id="fecha" required>
                <label for="descripcion" style="text-align: left;">Descripción</label>
                <textarea name="descripcion" id="descripcion" cols="30" rows="10" class="w-input"></textarea>
                <a href="#" class="take-photo1 w-button action-button grey"><i class="icon ion-camera"></i> Tomar Foto 1</a>
                <div id="photo1">
                    <img src="" alt="" id="photo1img">
                </div>
                <a href="#" class="take-photo2 w-button action-button grey"><i class="icon ion-camera"></i> Tomar Foto 2</a>
                <div id="photo2" style="margin-top: 10px;">
                    <img src="" alt="" id="photo2img">
                </div>
                <a href="#" class="take-photo2 w-button action-button grey"><i class="icon ion-camera"></i> Tomar Foto 3</a>
                <div id="photo3" style="margin-top: 10px;">
                    <img src="" alt="" id="photo3img">
                </div>
                <input type="submit" value="CREAR" class="w-button action-button grey" style="margin-top: 20px;" required>
            </form>
          </div>

      <div class="news-mask"></div>

        </div>

    </div>
    <div class="page-content loading-mask" id="new-stack">
      <div class="loading-icon">
        <div class="navbar-button-icon icon ion-load-d"></div>
      </div>
    </div>
  </section>
  <script src="js/webfont.js"></script>
  <script>
    WebFont.load({
      google: {
        families: ["Montserrat:400,700"]
      }
    });
  </script>
  <script type="text/javascript" src="js/modernizr.js"></script>
  <script type="text/javascript" src="js/jquery.min.js"></script>
  <script type="text/javascript" src="js/framework.js"></script>
  <script type="text/javascript" src="cordova.js"></script>
  <script type="text/javascript" src="js/scripts.js"></script>
  <!--[if lte IE 9]><script src="js/placeholders.min.js"></script><![endif]-->
  <script>
    $(document).on("ready", function(){
        var base_url = 'http://gps.somostusideas.info/api';
        var goToPage = function (hrefPage) {
            document.location = hrefPage;
        };
        var photoNew1 = '';
        var photoNew2 = '';
        var photoNew3 = '';

        $.ajax({
            type: "GET",
            url: 'http://gps.somostusideas.info/api/inmuebles?filter=ID_INMUEBLE;RAZONSOCIAL&user_id='+window.localStorage.getItem("id_user"),
            dataType: "json",
            success: function(data){
                console.log(data);
                $.each(data.data,function(key, registro) {
                    $("#select_inmueble").append('<option value='+registro.ID_INMUEBLE+'>'+registro.RAZONSOCIAL+'</option>');
                });
            }
        });

        function onSuccessCamera1(imageData) {
            //window.plugins.spinnerDialog.hide();
            var image = document.getElementById('photo1img');

            image.src = "data:image/jpeg;base64," + imageData;
            photoNew1 = image.src;

            window.plugins.spinnerDialog.hide();

            // Get Location
            //navigator.geolocation.getCurrentPosition(onSuccess, onError);
        }

        function onSuccessCamera2(imageData) {
            //window.plugins.spinnerDialog.hide();
            var image = document.getElementById('photo1img');

            image.src = "data:image/jpeg;base64," + imageData;
            photoNew2 = image.src;

            window.plugins.spinnerDialog.hide();

            // Get Location
            //navigator.geolocation.getCurrentPosition(onSuccess, onError);
        }

        function onSuccessCamera3(imageData) {
            //window.plugins.spinnerDialog.hide();
            var image = document.getElementById('photo1img');

            image.src = "data:image/jpeg;base64," + imageData;
            photoNew3 = image.src;

            window.plugins.spinnerDialog.hide();

            // Get Location
            //navigator.geolocation.getCurrentPosition(onSuccess, onError);
        }

        $("#form-insidencia").on("submit", function(e){
            e.preventDefault();

            // Save
            var currentdate = new Date(); 
            var datetime = currentdate.getFullYear() + "-"
                        + (currentdate.getMonth()+1)  + "-" 
                        + currentdate.getDate() + " "  
                        + currentdate.getHours() + ":"  
                        + currentdate.getMinutes() + ":" 
                        + currentdate.getSeconds();
            var dataSend = {
                'ID_INMUEBLE': $("#select_inmueble").val(),
                'FECHA': $("#fecha").val(),
                'DESCRIPCION': $("#descripcion").val(),
                'USUARIO': 'usuario',
                'SISTEMA': datetime,
                'FOTO1': photoNew1,
                'FOTO2': photoNew2,
                'FOTO3': photoNew3,
                'BITACORA': 'Registrado desde la APP'
            };

            // TODO: Guardar Datos
            $.ajax({
                type: 'POST',
                data: dataSend,
                url: base_url + '/incidencias',    
                beforeSend: function(){
                    window.plugins.spinnerDialog.show();
                },                     
                error: function (xhr, status, error) {
                    window.plugins.spinnerDialog.hide();
                    var err = JSON.parse(xhr.responseText);
                    if (!err.success) {
                        navigator.notification.alert(err.message, null, '', 'Cerrar');                                    
                    }
                },
                success: function (data) {
                    //alert(data);
                    if (data.success) {                                    
                        goToPage('incidencias.html');                        
                        window.plugins.spinnerDialog.hide();
                    }else{
                        navigator.notification.alert('Error.', null, '', 'Cerrar');                                   
                    }
                }
            });
        });

        function onFailCamera(message) {
            window.plugins.spinnerDialog.hide();
            navigator.notification.alert('Failed because: ' + message, null, '', 'Cerrar');
        }

        $(".take-photo1").on("click", function () {
            window.plugins.spinnerDialog.show();
            $this = $(this);

            if(typeof navigator !== 'undefined' && typeof navigator.camera !== 'undefined') {
                navigator.camera.getPicture(onSuccessCamera1, onFailCamera, {
                    quality: 30,
                    destinationType: Camera.DestinationType.DATA_URL
                });
            } else {
                alert('no navigator.camera - did you install the plugin?');
            }
        });

        $(".take-photo2").on("click", function () {
            window.plugins.spinnerDialog.show();
            $this = $(this);

            if(typeof navigator !== 'undefined' && typeof navigator.camera !== 'undefined') {
                navigator.camera.getPicture(onSuccessCamera2, onFailCamera, {
                    quality: 30,
                    destinationType: Camera.DestinationType.DATA_URL
                });
            } else {
                alert('no navigator.camera - did you install the plugin?');
            }
        });

        $(".take-photo3").on("click", function () {
            window.plugins.spinnerDialog.show();
            $this = $(this);

            if(typeof navigator !== 'undefined' && typeof navigator.camera !== 'undefined') {
                navigator.camera.getPicture(onSuccessCamera3, onFailCamera, {
                    quality: 30,
                    destinationType: Camera.DestinationType.DATA_URL
                });
            } else {
                alert('no navigator.camera - did you install the plugin?');
            }
        });
    }); 
  </script>
</body>
</html>